<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>영화 예매 시스템</title>
    <link rel="stylesheet" href="/css/style.css"> </head>
<body>
<header>
    <h1><a href="/">영화 예매 시스템</a></h1>
    <nav>
        <a href="/login.html" id="login-link">로그인</a>
        <a href="/signup.html" id="signup-link">회원가입</a>
        <a href="/my_bookings.html" id="my-bookings-link" style="display:none;">내 예매내역</a>
        <a href="/admin.html" id="admin-link" style="display:none;">관리자 페이지</a>
        <a href="/my_info.html" id="my-info-link" style="display:none;">내 정보</a>
        <a href="#" id="logout-link" style="display:none;">로그아웃</a>
    </nav>
</header>

<main>
    <h2>상영중인 영화</h2>
    <div id="movie-list" class="movie-grid">
    </div>
</main>

<script src="/js/auth.js"></script> <script src="/js/movies.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
      const adminLink = document.getElementById('admin-link');
      if (!adminLink) {
        console.warn('admin-link element not found');
        return;
      }

      try {
        const res = await fetch('/api/user/me', {
          credentials: 'include'
        });

        if (!res.ok) {
          // 로그인 안 된 상태 → 그냥 버튼 숨김
          adminLink.style.display = 'none';
          return;
        }

        const user = await res.json();
        console.log('checkAdmin user =', user);

        if (user.role === 'ADMIN') {
          adminLink.style.display = 'inline';       // 또는 inline-block
        } else {
          adminLink.style.display = 'none';
        }
      } catch (e) {
        console.error(e);
        adminLink.style.display = 'none';
      }
    });
</script>
</body>
</html>