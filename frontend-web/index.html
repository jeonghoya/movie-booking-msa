<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>영화 예매 시스템</title>
    <link rel="stylesheet" href="/css/style.css"> </head>
<body>
<header>
    <h1><a href="/">영화 예매 시스템</a></h1>
    <nav>
        <a href="/login.html" id="login-link">로그인</a>
        <a href="/signup.html" id="signup-link">회원가입</a>
        <a href="/my_bookings.html" id="my-bookings-link" style="display:none;">내 예매내역</a>
        <a href="/admin.html" id="admin-link" style="display:none;">관리자 페이지</a>
        <a href="/my_info.html" id="my-info-link" style="display:none;">내 정보</a>
        <a href="#" id="logout-link" style="display:none;">로그아웃</a>
    </nav>
</header>

<main>
    <h2>상영중인 영화</h2>
    <div id="movie-list" class="movie-grid">
    </div>
</main>

<script src="/js/auth.js"></script> <script src="/js/movies.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const adminLink = document.getElementById('admin-link');
        if (!adminLink) return;

        (async () => {
            try {
                const res = await fetch('/api/user/me', {
                    credentials: 'include'
                });

                if (!res.ok) {
                    adminLink.style.display = 'none';
                    return;
                }

                const user = await res.json();
                console.log('checkAdmin user =', user);   // ⭐ 실제 role 값 한번 확인

                // role이 "ADMIN" 이거나, "ROLE_ADMIN" 이거나, {name:"ADMIN"} 형태인 경우까지 커버
                let role = '';

                if (typeof user.role === 'string') {
                    role = user.role;
                } else if (user.role && typeof user.role.name === 'string') {
                    role = user.role.name;
                }

                if (role === 'ADMIN' || role === 'ROLE_ADMIN') {
                    adminLink.style.display = 'inline';
                } else {
                    adminLink.style.display = 'none';
                }
            } catch (e) {
                console.error('checkAdmin error', e);
                adminLink.style.display = 'none';
            }
        })();
    });
</script>
</body>
</html>