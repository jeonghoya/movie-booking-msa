# reverse-proxy/nginx.conf

# 프론트엔드
upstream frontend_web {
    server frontend-web:80;
}

# 유저 서비스
upstream user_service {
    server user-service:8081;
}

# 코어 서비스
upstream core_service {
    server core-service:8082;
}

server {
    listen 80;
    server_name movie-booking.com;

    # 기본: 프론트엔드
    location / {
        proxy_pass http://frontend_web;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ------------------------------------
    # /api/user → user-service (URI 그대로 유지)
    # ------------------------------------
    location /api/user/ {
        proxy_pass http://user_service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # ------------------------------------
    # /api/core → core-service (URI 그대로 유지)
    # ------------------------------------
    location /api/core/ {
        proxy_pass http://core_service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
